#include "corner_cube.h"

#include <avr/pgmspace.h>

#include "..\..\diodes_util.h"
#include "..\..\main.h"

int8_t corner_cube(uint16_t number_of_frames) {
	static const uint64_t cube_data[][6] PROGMEM = {
		{
			d(0)|d(1)|d(2)|d(3)|d(4)|d(7)|d(8)|d(11)|d(12)|d(13)|d(14)|d(15)|d(16)|d(19)|d(28)|d(31)|d(32)|d(35)|d(44)|d(47)|d(48)|d(49)|d(50)|d(51)|d(52)|d(55)|d(56)|d(59)|d(60)|d(61)|d(62)|d(63),
			d(0)|d(1)|d(2)|d(4)|d(6)|d(8)|d(9)|d(10)|d(16)|d(18)|d(24)|d(26)|d(32)|d(33)|d(34)|d(36)|d(38)|d(40)|d(41)|d(42),
			d(0)|d(1)|d(4)|d(5)|d(16)|d(17)|d(20)|d(21),
			d(0),
			d(0)|d(1)|d(4)|d(5)|d(16)|d(17)|d(20)|d(21),
			d(0)|d(1)|d(2)|d(4)|d(6)|d(8)|d(9)|d(10)|d(16)|d(18)|d(24)|d(26)|d(32)|d(33)|d(34)|d(36)|d(38)|d(40)|d(41)|d(42)
		},
		{
			d(0)|d(1)|d(2)|d(3)|d(4)|d(7)|d(8)|d(11)|d(12)|d(13)|d(14)|d(15)|d(16)|d(19)|d(28)|d(31)|d(32)|d(35)|d(44)|d(47)|d(48)|d(49)|d(50)|d(51)|d(52)|d(55)|d(56)|d(59)|d(60)|d(61)|d(62)|d(63),
			d(1)|d(2)|d(3)|d(5)|d(7)|d(9)|d(10)|d(11)|d(17)|d(19)|d(25)|d(27)|d(33)|d(34)|d(35)|d(37)|d(39)|d(41)|d(42)|d(43),
			d(2)|d(3)|d(6)|d(7)|d(18)|d(19)|d(22)|d(23),
			d(3),
			d(2)|d(3)|d(6)|d(7)|d(18)|d(19)|d(22)|d(23),
			d(1)|d(2)|d(3)|d(5)|d(7)|d(9)|d(10)|d(11)|d(17)|d(19)|d(25)|d(27)|d(33)|d(34)|d(35)|d(37)|d(39)|d(41)|d(42)|d(43)
		},
		{
			d(0)|d(1)|d(2)|d(3)|d(4)|d(7)|d(8)|d(11)|d(12)|d(13)|d(14)|d(15)|d(16)|d(19)|d(28)|d(31)|d(32)|d(35)|d(44)|d(47)|d(48)|d(49)|d(50)|d(51)|d(52)|d(55)|d(56)|d(59)|d(60)|d(61)|d(62)|d(63),
			d(4)|d(5)|d(6)|d(8)|d(10)|d(12)|d(13)|d(14)|d(20)|d(22)|d(28)|d(30)|d(36)|d(37)|d(38)|d(40)|d(42)|d(44)|d(45)|d(46),
			d(8)|d(9)|d(12)|d(13)|d(24)|d(25)|d(28)|d(29),
			d(12),
			d(8)|d(9)|d(12)|d(13)|d(24)|d(25)|d(28)|d(29),
			d(4)|d(5)|d(6)|d(8)|d(10)|d(12)|d(13)|d(14)|d(20)|d(22)|d(28)|d(30)|d(36)|d(37)|d(38)|d(40)|d(42)|d(44)|d(45)|d(46)
		},
		{
			d(0)|d(1)|d(2)|d(3)|d(4)|d(7)|d(8)|d(11)|d(12)|d(13)|d(14)|d(15)|d(16)|d(19)|d(28)|d(31)|d(32)|d(35)|d(44)|d(47)|d(48)|d(49)|d(50)|d(51)|d(52)|d(55)|d(56)|d(59)|d(60)|d(61)|d(62)|d(63),
			d(5)|d(6)|d(7)|d(9)|d(11)|d(13)|d(14)|d(15)|d(21)|d(23)|d(29)|d(31)|d(37)|d(38)|d(39)|d(41)|d(43)|d(45)|d(46)|d(47),
			d(10)|d(11)|d(14)|d(15)|d(26)|d(27)|d(30)|d(31),
			d(15),
			d(10)|d(11)|d(14)|d(15)|d(26)|d(27)|d(30)|d(31),
			d(5)|d(6)|d(7)|d(9)|d(11)|d(13)|d(14)|d(15)|d(21)|d(23)|d(29)|d(31)|d(37)|d(38)|d(39)|d(41)|d(43)|d(45)|d(46)|d(47)
		},
		{
			d(0)|d(1)|d(2)|d(3)|d(4)|d(7)|d(8)|d(11)|d(12)|d(13)|d(14)|d(15)|d(16)|d(19)|d(28)|d(31)|d(32)|d(35)|d(44)|d(47)|d(48)|d(49)|d(50)|d(51)|d(52)|d(55)|d(56)|d(59)|d(60)|d(61)|d(62)|d(63),
			d(16)|d(17)|d(18)|d(20)|d(22)|d(24)|d(25)|d(26)|d(32)|d(34)|d(40)|d(42)|d(48)|d(49)|d(50)|d(52)|d(54)|d(56)|d(57)|d(58),
			d(32)|d(33)|d(36)|d(37)|d(48)|d(49)|d(52)|d(53),
			d(48),
			d(32)|d(33)|d(36)|d(37)|d(48)|d(49)|d(52)|d(53),
			d(16)|d(17)|d(18)|d(20)|d(22)|d(24)|d(25)|d(26)|d(32)|d(34)|d(40)|d(42)|d(48)|d(49)|d(50)|d(52)|d(54)|d(56)|d(57)|d(58)
		},
		{
			d(0)|d(1)|d(2)|d(3)|d(4)|d(7)|d(8)|d(11)|d(12)|d(13)|d(14)|d(15)|d(16)|d(19)|d(28)|d(31)|d(32)|d(35)|d(44)|d(47)|d(48)|d(49)|d(50)|d(51)|d(52)|d(55)|d(56)|d(59)|d(60)|d(61)|d(62)|d(63),
			d(17)|d(18)|d(19)|d(21)|d(23)|d(25)|d(26)|d(27)|d(33)|d(35)|d(41)|d(43)|d(49)|d(50)|d(51)|d(53)|d(55)|d(57)|d(58)|d(59),
			d(34)|d(35)|d(38)|d(39)|d(50)|d(51)|d(54)|d(55),
			d(51),
			d(34)|d(35)|d(38)|d(39)|d(50)|d(51)|d(54)|d(55),
			d(17)|d(18)|d(19)|d(21)|d(23)|d(25)|d(26)|d(27)|d(33)|d(35)|d(41)|d(43)|d(49)|d(50)|d(51)|d(53)|d(55)|d(57)|d(58)|d(59)
		},
		{
			d(0)|d(1)|d(2)|d(3)|d(4)|d(7)|d(8)|d(11)|d(12)|d(13)|d(14)|d(15)|d(16)|d(19)|d(28)|d(31)|d(32)|d(35)|d(44)|d(47)|d(48)|d(49)|d(50)|d(51)|d(52)|d(55)|d(56)|d(59)|d(60)|d(61)|d(62)|d(63),
			d(20)|d(21)|d(22)|d(24)|d(26)|d(28)|d(29)|d(30)|d(36)|d(38)|d(44)|d(46)|d(52)|d(53)|d(54)|d(56)|d(58)|d(60)|d(61)|d(62),
			d(40)|d(41)|d(44)|d(45)|d(56)|d(57)|d(60)|d(61),
			d(60),
			d(40)|d(41)|d(44)|d(45)|d(56)|d(57)|d(60)|d(61),
			d(20)|d(21)|d(22)|d(24)|d(26)|d(28)|d(29)|d(30)|d(36)|d(38)|d(44)|d(46)|d(52)|d(53)|d(54)|d(56)|d(58)|d(60)|d(61)|d(62)
		},
		{
			d(0)|d(1)|d(2)|d(3)|d(4)|d(7)|d(8)|d(11)|d(12)|d(13)|d(14)|d(15)|d(16)|d(19)|d(28)|d(31)|d(32)|d(35)|d(44)|d(47)|d(48)|d(49)|d(50)|d(51)|d(52)|d(55)|d(56)|d(59)|d(60)|d(61)|d(62)|d(63),
			d(21)|d(22)|d(23)|d(25)|d(27)|d(29)|d(30)|d(31)|d(37)|d(39)|d(45)|d(47)|d(53)|d(54)|d(55)|d(57)|d(59)|d(61)|d(62)|d(63),
			d(42)|d(43)|d(46)|d(47)|d(58)|d(59)|d(62)|d(63),
			d(63),
			d(42)|d(43)|d(46)|d(47)|d(58)|d(59)|d(62)|d(63),
			d(21)|d(22)|d(23)|d(25)|d(27)|d(29)|d(30)|d(31)|d(37)|d(39)|d(45)|d(47)|d(53)|d(54)|d(55)|d(57)|d(59)|d(61)|d(62)|d(63)
		}
	};
	
	uint16_t frame_number = 0;
	while (true) {
		uint8_t corner = rnd() & 0x07; // corners number

		for (auto const& frame_flash : cube_data[corner]) {
			uint64_t frame_data;
			memcpy_P(&frame_data, &frame_flash, sizeof(**cube_data));
			int8_t result = render_frame(frame_data, 200);
			if (result != 0) {
				return result;
			}
			if (number_of_frames > 0 && ++frame_number >= number_of_frames) { // return if number of frames exceeded
				return 0;
			}
		}
	}
}